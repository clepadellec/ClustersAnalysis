---
title: "Projet_Clustering"
author: "Clement Le Padellec"
date: "27 avril 2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warnings=FALSE)

```

```{r echo=FALSE, include=FALSE}
#Chargement des packages n?cessaires
install.packages(c("FactoMineR", "factoextra", "questionr","xlsx","fpc","corrplot","ExPosition" ),repos = "http://cran.us.r-project.org")
library("fpc")
library("FactoMineR")
library("factoextra")
library("questionr")

library("corrplot")
library("ExPosition")


```

```{r echo=FALSE, include=FALSE}
#setwd('C:/Users/clementlepadellec/Downloads/')
data_0=read.csv2("Donn√©es-R-1.csv", sep=";", row.names = 1)
```
## **Statistiques Descriptives**
```{r echo=FALSE}
data.qt = data_0[,1:10]

#aper?u des donn?es
print(summary(data_0))

#premier regard sur la corr?lation
cor(data.qt)
plot(data.qt)

#Au premier abord les variables corr?l?es avec l'index semblent ?tre :

#positivement : esperance, bien ?tre, heureux
#n?gativement : ineg_rev

#r?partition des donn?es par variables / 1er regard sur certains individus atypiques

#indicateurs
boxplot(data.qt[,1:8])
# a part pour la variable empreinte il ne semble pas y avoir d'individu atypique
#PIB
boxplot(data.qt[,9])
#On remarque quue certains individus ont un PIB nettement sup?rieur ? la moyenne
#Population
boxplot(data.qt[,10])
#Sur ce graphique il semble y avoir 2 pays qui ont une populations nettement sup?rieur aux autres pays

#On sait dor?navant que pour certaines variables, les individus peuvent avoir des valeurs ab?rrentes, il faudra se m?fier ? ce que cel? n'impacte pas nos analyses
```
## **Analyse des correspondances principales**

### *S?lection des variables actives*
```{r echo=FALSE}
data.active = data_0[,c('Esperance', 'Bien.Etre', 'Heureux', 'Empreinte','Ineg_rev','Ineg_BE', 'Ineg_esp', 'PIB','Population')]
head(data.active)

```
### *Mise en place de l'ACP*
```{r}
#mise en place de l'acp avec l'option pour centrer r?duire les donn?es
res.pca <- PCA(data.active, scale.unit = TRUE, ncp = 3, graph = T)
print(res.pca)
# graphique ?cras? car 2 individus contribuent tr?s fortement ? la construction de l'axe 2
```
```{r}
eig.val <- get_eigenvalue(res.pca) 
eig.val
fviz_eig(res.pca, addlabels = TRUE, ylim = c(0, 50))
```
-> On retient les valeurs avec valeurs propres > 1 donc les 2 premi?res
-> Les variables bien repr?sent?es sont les variables qui ont un cosinus carr? ?lev?, et les variables qui contribuent sont les variables qui ont une contribution ?lev?e
-> Cr?ation d'une variable "var" avec tous les r?sultats concernants les variables :
```{r}
var <- get_pca_var(res.pca)
var

#-> Graphique du Cos2 des variables sur le 1 premier axe : 

fviz_cos2(res.pca, choice = "var")

var$coord
var$cos2
var$contrib
```

### *Analyse de l'axe 1*

```{r}

coord <- var$coord[,1]
contrib <- var$contrib[,1]
cos2 <- var$cos2[,1]
display <- cbind(coord,contrib,cos2)
display
#L'axe 1 met en ?vidence du cot? positif les pays qui sont bien not?es en heureux et mal not? en ineg_rev, et du cot? n?gatif, les pays bien not?s en Ineg_rev et mal not? en heureux
```

### *Analyse de l'axe 1*

```{r}

coord <- var$coord[,2]
contrib <- var$contrib[,2]
cos2 <- var$cos2[,2]
display <- cbind(coord,contrib,cos2)
display
```
 
L'axe 2 met en ?vidence  du cot? positif les pays qui sont bien not?s en population 



```{r}
#contribution des individus aux dim 1 et dim 2
fviz_contrib(res.pca, choice = "ind", axes = 1,top = 10)


fviz_contrib(res.pca, choice = "ind", axes = 1:2, top = 10)
```

```{r}
fviz_pca_biplot(res.pca, repel = TRUE,
                
                col.var = "#2E9FDF", # Couleur des variables
                addEllipses = TRUE, col.ind = "#696969" # Couleur des individues
)
```

### *Passage de population et PIB en illustrative*
```{r}
res.pca2 <- PCA(data.active, ind.sup = NULL,
                quanti.sup = 8:9, graph=TRUE)

eig.val <- get_eigenvalue(res.pca2) 
eig.val
fviz_eig(res.pca, addlabels = TRUE, ylim = c(0, 50))
```

```{r}
fviz_pca_biplot(res.pca2, repel = TRUE,
                
                col.var = "#2E9FDF", # Couleur des variables
                addEllipses = TRUE, col.ind = "#696969" # Couleur des individus
)
```

```{r}
fviz_contrib(res.pca2, choice = "ind", axes = 1:2, top = 10)
```

```{r}
fviz_contrib(res.pca2, choice = "ind", axes = 1,top = 10)
```


## **Analyse factorielle des correspondances**

### *Transformation des donn?es*
```{r echo=FALSE}
#transformation de la variable quanti "Heureux" en une variable qualitative
data_0$heureux_quali <- cut(data_0$Heureux, breaks = 4, include.lowest = TRUE, labels = c("heureux.1", "heureux.2", "heureux.3", "heureux.4"))

#affichage des fr?quence
freq(data_0$heureux_quali)


#on supprime les variables quantitaives 
data = data_0[-c(1:11)]

#on s'assure que tout est bien en cha?ne de caract?re
str(data)
names(data) #noms des variables restantes
data$liberte_internet<- factor(data$liberte_internet, levels = c("F", "PF","NF")) 

```


### *Tableau de contingence,test du khi2 et profils lignes/colonnes pour v?rifier l'ind?pendance*

#### Lien entre le fait d'?tre heureux (heureux_quali) et la R?gion


```{r echo=FALSE}

#quali ordinale avec du quali ordinal

#affichage du tableau
contingence_h_r = table(data$heureux_quali, data$Region)
contingence_h_r
#graphiques
colors <- c("chartreuse4", "chartreuse1", "orange")
barplot(contingence_h_r, col=colors, main = "heureux par libert? sur internet", ylab="nombre ")
mosaicplot(contingence_h_r, col = colors)
```
```{r echo=FALSE}
#r?alisation des profils ligne et colonne
lprop(contingence_h_r, digits=1)#la distribution de la r?gion parmis ceux heureux || 4 profils lignes 
#ensemble = profil moyen
cprop(contingence_h_r, digits=2)
#on s'uppose la d?pendance car les profils sont distincts

```
```{r echo=FALSE}
# on test l'ind?pendance
chisq = chisq.test(contingence_h_r)
chisq
#il existe un lien car pvalue < 5% on accepte h0


```

#### Lien entre le fait d'?tre heureux et le r?gime politique

```{r echo=FALSE}

#cr?ation du tableau de contingence
contingence_h_p = table(data$heureux_quali, data$Regime_poli)
contingence_h_p

```

```{r echo=FALSE}

#r?alisation des profils ligne et colonne
lprop(contingence_h_p, digits=1)#le R?gime politique parmis ceux qui sont hereux || 4 profils lignes 
cprop(contingence_h_p, digits=2)
#on suppose la d?pendance car les profils sont distincts

```
```{r echo=FALSE}
# on test l'ind?pendance
chisq = chisq.test(contingence_h_p)
chisq
#<5% donc acceptation de h0 donc lien
```

```{r}
#lien mais trop de classes, on a donc essay? de r?duire en 3 classes :
contingence_h_p_s = table(data$heureux_quali, data$R?gime_simp) #l'ex?cution marche m?me si erreur ? cause de l'accent
contingence_h_p_s

# on test l'ind?pendance
chisq = chisq.test(contingence_h_p_s)
chisq
#il y a bien un lien
```


#### Lien entre le fait d'?tre heureux et la libert? internet

```{r echo=FALSE}

#quali ordinale avec du quali 

#cr?ation du tableau de contingence

contingence_h_i = table(data$heureux_quali, data$liberte_internet)
contingence_h_i

```

```{r echo=FALSE}

#r?alisation des profils ligne et colonne
lprop(contingence_h_i, digits=1)
cprop(contingence_h_i, digits=2)
#on s'uppose la d?pendance car les profils sont distincts
```

```{r echo=FALSE}
# on test l'ind?pendance
chisq = chisq.test(contingence_h_i)
chisq
#il y a bien un lien

```

#### Lien entre le fait d'?tre heureux et le nombre d'ann?es d'?tudes

```{r echo=FALSE}
#quali ordinale avec du quali 

#cr?ation du tableau de contingence

contingence_h_e = table(data$nb_annee_scolaire_moy, data$heureux_quali)
contingence_h_e

```

```{r echo=FALSE}
#r?alisation des profils ligne et colonne
lprop(contingence_h_e, digits=1)
cprop(contingence_h_e, digits=2)
#on s'uppose la d?pendance car les profils sont distincts

```

```{r echo=FALSE}
# on test l'ind?pendance
chisq = chisq.test(contingence_h_e)
chisq
#il y a bien un lien

```

### *R?alisation des AFC*

Malgr? le fait que toutes les variables soient li?es au fait d'?tre heureux, on ne r?alisera que deux AFC qui nous paraissent les plus pertinentes.Il s'agit du lien entre la r?gion et le fait d'?tre heureux et du lien entre le r?gime politique et le fait d'?tre heureux

#### Entre le fait d'?tre heureux (heureux_quali) et la R?gion

```{r echo=FALSE}
#Mise en place de l'AFC
res.ca <- CA(contingence_h_r, graph = TRUE)
print(res.ca)
#visualisation des valeurs propres
eig.val <- get_eigenvalue(res.ca)
eig.val
#3 valeurs propres car min(n-1)(p-1)
fviz_eig(res.ca, addlabels = TRUE, ylim = c(0,100))#graphique des valeurs propres avec la 
#Visualisation des profils lignes et colonnes dans un meme graphique
#on garde que 1 axe, car coude + 73% d'inertie

fviz_ca_biplot (res.ca, repel = TRUE) #argument repel pour eviter le chevauchement
```

```{r echo=FALSE}

#Resultats pour les profils lignes

row<-get_ca_row(res.ca)
row

coord <- row$coord[,1]
contrib <- row$contrib[,1]
cos2 <- row$cos2[,1]
display <- cbind(coord,contrib,cos2)
display
#DU cot? + de l'axe on retrouve le profil des tr?s heureux et heureux contrairement au cot? - ou on retrouve le profil des pas heureux
#la R?gion pour ceux tr?s heureux n'est pas la m?me que la distribution de l'age pour les pas heureux
#ceux tr?s heureux ne se trouvent pas dans la m?me r?gion que ceux pas heureux

fviz_ca_row(res.ca, repel = TRUE)#Visualisation des profils lignes
corrplot(row$cos2, is.corr = FALSE)# graphique du Cos2 des profils lignes sur tous les axes
fviz_cos2(res.ca, choice = "row")# graphique du Cos2 des profiles lignes sur le 1er axe
corrplot(row$contrib, is.corr=FALSE)# graphique de la contributions des profils lignes sur tous les axes
fviz_contrib(res.ca, choice = "row")# graphique de la contribution des profiles lignes sur le 1er axe
```

```{r echo=FALSE}
#Resultats pour les profils colonnes

col<-get_ca_col(res.ca)
col

head(col$coord)# Coordonnees des profils colonnes
#DU cot? + de l'axe 1 on retrouve le profil des Europ?ens, Am?ricains contrairement au cot? - ou on retrouve le profil des moins des Africains sub Sahara
#la distribution du fait d'?tre heureux pour les Europ?ens et Am?ricains n'est pas la m?me que la distribution du fait d'?tre heureux pour les Africains sub Sahara


head(col$cos2)# Cos2
#les Africains SUb Sahara contribuent beaucoup, c'est eux qui caract?risent le cot? - de l'axe 1
#les Europ?ns contribuent bcp, c'est eux qui caract?risent le cot? - de l'axe 1
head(col$contrib)# Contributions aux axes des profils colonnes

fviz_ca_col(res.ca, repel = TRUE)#Visualisation des profils colonnes


corrplot(col$cos2, is.corr = FALSE)# graphique du Cos2 des profils colonnes sur tous les axes
fviz_cos2(res.ca, choice = "col")# graphique du Cos2 des profiles colonnes sur le 1er axe

corrplot(col$contrib, is.corr=FALSE)# graphique de la contributions des profils colonnes sur tous les axes
fviz_contrib(res.ca, choice = "col")# graphique de la contribution des profiles colonnes sur le 1er axe
```

```{r echo=FALSE}
# Representation graphique simultanee

fviz_ca_biplot (res.ca, repel = TRUE) #Visualisation des profils lignes et colonnes dans un meme graphique
#seules les distances entre les profils lignes entre eux ou entre les profils colonnes entre eux peuvent s'interpreter

#on retrouve profil ligne et profil colonne
#plus les points de m?mes couleurs sont proches plus ils ont la m?me opinion
#entre points diff?rents c'est juste pour aiguiller
#on doit revenir vers le tableau de contingence et les profil pour voir si lien


#Description des dimensions et mise en evidence des profils qui contribuent le plus aux axes 

# Description de la dimension
res.desc <- dimdesc(res.ca, axes = c(1, 2))
head(res.desc[[1]]$row, 4) # Description de la dimension 1 par les lignes
head(res.desc[[1]]$col, 4) # Description de la dimension 1 par les colonnes


```

#### Entre le fait d'?tre heureux et le r?gime politique

```{r echo=FALSE}
#Mise en place de l'AFC
res.ca <- CA(contingence_h_p, graph = FALSE) 
print(res.ca)
#visualisation des valeurs propres
eig.val <- get_eigenvalue(res.ca)
eig.val
#3 valeurs propres car min(n-1)(p-1)
fviz_eig(res.ca, addlabels = TRUE, ylim = c(0,100))#graphique des valeurs propres avec la 
#Visualisation des profils lignes et colonnes dans un meme graphique
#on garde que 1 axe, car coude

fviz_ca_biplot (res.ca, repel = TRUE) 


```

```{r echo=FALSE}
#Resultats pour les profils lignes

row<-get_ca_row(res.ca)
row

head(row$coord)# Coordonnees des profils lignes

#DU cot? + de l'axe on retrouve le profil des tr?s heureux contrairement au cot? - ou on retrouve le profil des pas heureux et peu heureux
#le r?gime politique pour ceux tr?s heureux n'est pas la m?me que le r?gime politique pour les peu et pas heureux
#ceux tr?s heureux n'ont pas le m?me r?gime politique que ceux pas heureux


head(row$cos2)# Cos2

head(row$contrib)# Contributions aux axes des profils lignes

fviz_ca_row(res.ca, repel = TRUE)#Visualisation des profils lignes




corrplot(row$cos2, is.corr = FALSE)# graphique du Cos2 des profils lignes sur tous les axes
fviz_cos2(res.ca, choice = "row")# graphique du Cos2 des profiles lignes sur le 1er axe


corrplot(row$contrib, is.corr=FALSE)# graphique de la contributions des profils lignes sur tous les axes
fviz_contrib(res.ca, choice = "row")# graphique de la contribution des profiles lignes sur le 1er axe

```

```{r echo=FALSE}
#Resultats pour les profils colonnes 
col<-get_ca_col(res.ca)
col

head(col$coord,12)# Coordonnees des profils colonnes
#DU cot? + de l'axe 1 on retrouve le profil des Monarchies avec fonctions symboliques et R?gime directorial contrairement au cot? - ou on retrouve le profil des Etats ? parti unique, Monarchie ? pouvoir effectif, r?gime hybride et r?gime pr?sidentiel avec premier ministre
#la distribution du fait d'?tre heureux pour les monarchies ? fonctions symboliques et r?gime directorial n'est pas la m?me que la distribution du fait d'?tre heureux pour les Etats ? parti unique et monarchie ? pouvoir effectif


head(col$cos2,12)# Cos2

#les R?gimes pr?sidentiels avec Premier ministre, Etats ? parti unique et monarchie ? pouvoir effectif contribuent bcp, c'est eux qui caract?risent le cot? - de l'axe 1
#les monarchies ? pouvoir symbolique et r?gime directorial contribuent bcp, c'est eux qui caract?risent le cot? - de l'axe 1

head(col$contrib,12)# Contributions aux axes des profils colonnes

fviz_ca_col(res.ca, repel = TRUE)#Visualisation des profils colonnes


corrplot(col$cos2, is.corr = FALSE)# graphique du Cos2 des profils colonnes sur tous les axes
fviz_cos2(res.ca, choice = "col")# graphique du Cos2 des profiles colonnes sur le 1er axe

corrplot(col$contrib, is.corr=FALSE)# graphique de la contributions des profils colonnes sur tous les axes
fviz_contrib(res.ca, choice = "col")# graphique de la contribution des profiles colonnes sur le 1er axe


```

```{r echo=FALSE}

#
# Representation graphique simultanee 
#
fviz_ca_biplot (res.ca, repel = TRUE) #Visualisation des profils lignes et colonnes dans un meme graphique


#on retrouve profil ligne et profil colonne
#plus points de m?mes couleurs sonr ptoche plus ils ont la m?me opinion
#entre points diff?rents c'est juste pour aiguiller
#on doit revenir vers le tableau de contingence et les profil pour voir si lien


#Description des dimensions et mise en evidence des profils qui contribuent le plus aux axes 
# Description de la dimension
res.desc <- dimdesc(res.ca, axes = c(1, 2))
head(res.desc[[1]]$row, 4) # Description de la dimension 1 par les lignes
head(res.desc[[1]]$col, 4) # Description de la dimension 1 par les colonnes


```


## **Analyse des correspondances multiples**

### *Pr?paration des donn?es*

```{r echo=FALSE}
data = data_0[c(8,14:16,18)]
print(data)
#var 8= index qui passera en quanti sup
#autres vars = R?gion, R?gime politique et libert? sur internet
```

### *Mise en place de l'ACM*

```{r echo=FALSE}

# Analyse correspondances multiples (ACM) 

res.mca <- MCA (data, quanti.sup = 1, graph = TRUE)  #calcul de l'ACM, resultats mis dans une variable
print(res.mca) #Variable resultat contient tous les elements suivants


#p-s valeurs propres avec s = nb de variables
#ici 15 (13-4)
#Visualisation des valeurs propres
eig.val <- get_eigenvalue(res.mca) 
eig.val

fviz_eig(res.mca, addlabels = TRUE, ylim = c(0, 50)) #graphique des valeurs propres avec la fonction fviz_eig() ou fviz_screeplot() du package factoextra
#avec coude on garde 1 axe, (1/9 = 0.111 donc 11%), donc il devrait avoir 11 sur chaque axe, dans le 1 on en retrouve 28
#donc c'est beaucoup plus, donc il est bien repr?sentatif
#pour l'axe 2, par rapport ? moyenne, il est au dessus 

```

```{r echo=FALSE}
#on va corriger les valeurs propres avec la correction de Benz?cri
res.mca.ben = epMCA(data[,1:5], graphs = FALSE, correction = "b")
fviz_eig(res.mca.ben)
#donc toute l'inertie sur l'axe 1


```

### *R?sultats pour les individus*

```{r echo=FALSE}
#Rzsultats pour les individus (= points lignes)
#
ind <- get_mca_ind (res.mca)
ind

ind$coord# Coordonnees des profils lignes


ind$cos2# Cos2: qualite de representation des profils lignes
ind$contrib# Contributions aux axes des profils lignes
#Visualisation des points lignes
fviz_mca_ind(res.mca, select.ind = list(cos2 = 80),col.ind = "contrib",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE 
)                   
#du cot? + de l'axe 1 on retrouve Australie, Autriche, Belgique, Canada,etc
#du cot? - de l'axe 1 on retrouve Chine, Afghanistan, Turkemistan, Ethipi, etc
#ces deux groupes de pays ne seront pas not? de la m?me facon


```

### *R?sultats pourles modalit?s*

```{r echo=FALSE}
#Resultats pour les modalites (=points colonnes)
#
var <- get_mca_var(res.mca)
var

head(var$coord)# Coordonnees des points colonnes
head(var$cos2)# Cos2: qualite de representation des points colonnes
head(var$contrib)# Contributions aux axes des points colonnes

fviz_mca_var (res.mca, choice = "mca.cor", repel = TRUE) #Visualisation de la correlation des variables avec les axes


corrplot(var$cos2, is.corr=FALSE)# graphique du Cos2 des points colonnes sur tous les axes
fviz_cos2(res.mca, choice = "var")# graphique du Cos2 des points colonnes sur le 1er axe
corrplot(var$contrib, is.corr=FALSE)# graphique de la contributions des points colonnes sur tous les axes
fviz_contrib(res.mca, choice = "var")# graphique de la contribution des points colonnes sur le 1er axe


```
```{r echo=FALSE}

#Description des dimensions et mise en evidence des points qui contribuent le plus aux axes 

# Description de la dimension
res.desc <- dimdesc(res.mca, axes = c(1, 2))#fonction dimdesc() [dans FactoMineR]
res.desc[[1]]
res.desc[[2]]

var
coord = var$coord[,1]
contrib = var$contrib[,1]
cos2 = var$cos2[,1]
display = cbind(coord, contrib, cos2)
display

#du cot? + de l'axe 1 on retrouve l'acc?s ? internet ? plus de 75% de la population, ?tre libre sur internet, plus de 15 ans d'?tude, ?tre une monarchie
#du cot? + de l'axe 1 on retrouve l'acc?s ? internet ? moins de 25% de la population, moins de 10 ans d'?tude, ?tre une dictature

# Biplot des lignes et colonnes
fviz_mca_biplot(res.mca, select.ind = list(cos2 = 75),
                repel = TRUE 
)  
```

## **Classification**

### *1ere classification avec les CAH*

#### Pr?paration des donn?es

```{r}
#On ne garde que les variables quantitatives
data <- data_0[,1:10]
#Certaines variables n'ont pas les m?mes ?chelles de grandeurs
#On d?cide donc de centrer et r?duire les donn?es
data.cr<-scale(data, center = T, scale=T)

#matrice des distances entre individus
d.data <- dist(data.cr)
```

#### Mise en place du dendrogramme

```{r}
#CAH - crit?re de Ward
#method = ? ward.D2 ? correspond au vrai crit?re de Ward
#utilisant le carr? de la distance
cah.ward <- hclust(d.data,method="ward.D2")

#affichage dendrogramme
plot(cah.ward)

#Au vu du dendogramme, on pourrait d?cider d?cider de d?couper en 5 classes

#On regarde l'inertie expliqu?e par classes
inertie <- sort(cah.ward$height, decreasing = TRUE)


plot(inertie[1:20], type = "s", xlab = "Nombre de classes", ylab = "Inertie")
#On remarque des sauts assez cons?quents jusque la classe 6, puis les sauts deviennent plus faibles
#On peut donc choisir de d?couper en 6 groupes

#dendrogramme avec mat?rialisation des groupes
plot(cah.ward)
rect.hclust(cah.ward,k=6)
#d?coupage en 6 groupes
groupes.cah <- cutree(cah.ward,k=6)

```

#### Analyse des groupes

```{r}
#liste des groupes
print(sort(groupes.cah))

#difficile d'analyser les groupes au 1er abord, on va donc compl?ter l'analyse avec une acp norm?e
#ACP norm?e
acp <- princomp(data,cor=T,scores=T)
#screeplot - 1 axe retenu
plot(1:10,acp$sdev^2,type="b",xlab="Nb. de facteurs",ylab="Val. Propres")
#biplot
biplot(acp,cex=0.60,col=c("orange","red"),xlim=c(-0.3,0.3),ylim=c(-0.45,0.25))

#On distingue clairement un individu atypique : le luxembourg qui a une empreinte tr?s ?lev?e par rapport aux autres pays
#positionnement des groupes dans le plan factoriel avec ?tiquettes des points
plot(acp$scores[,1],acp$scores[,2],type="n",xlim=c(-5,5),ylim=c(-5,5))

text(acp$scores[,1],acp$scores[,2],col=c("red","green","blue","black","orange","grey")[groupes.cah],cex
     =0.65,labels=rownames(data),xlim=c(-5,5),ylim=c(-5,5))

#A premi?re vu on remarque qu'on a, du c?t? positif de l'axe, les pays qui ont des fortes valeurs dans les variables esp?rance, in?galit?s d'esp?rance, bien ?tre, heureux, in?galit? de bien ?tre et une faible valeur concernant les in?galit?s de revenus. A l'inverse, du c?t? n?gatif, on retrouve les pays qui ont de fortes in?galit?s de revenus mais de faibles valeurs dans les variables esp?rance, in?galit?s d'esp?rance, bien ?tre, heureux, in?galit? de bien ?tre.

#2 individus sont isol?s car ils poss?dent une population tr?s ?lev?e : L'inde et la Chine
#Nous savions ?galement que le PIB aurait un impact sur la construction des groupes, nous d?cidons donc
#de refaire une classification sans le luxembourg et sans les variables pib/population

```

### *2eme classification avec les CAH sans les individus atypiques*
#### Pr?paration des donn?es

```{r}
#CAH sans le luxembourg, pib, population
data <- data_0[-73,1:8]
#Certaines variables n'ont pas les m?mes ?chelles de grandeurs
#On d?cide donc de centrer et r?duire les donn?es
data.cr<-scale(data, center = T, scale=T)

#matrice des distances entre individus
d.data <- dist(data.cr)

```

#### Mise en place du dendrogramme

```{r}
#CAH - crit?re de Ward
#method = ? ward.D2 ? correspond au vrai crit?re de Ward
#utilisant le carr? de la distance
cah.ward <- hclust(d.data,method="ward.D2")

#affichage dendrogramme
plot(cah.ward)

#Au vu du dendogramme, on pourrait d?cider d?cider de d?couper en 4 classes

#On regarde l'inertie expliqu?e par classes
inertie <- sort(cah.ward$height, decreasing = TRUE)

plot(inertie[1:20], type = "s", xlab = "Nombre de classes", ylab = "Inertie")
#On remarque des sauts assez cons?quents jusque la classe 5, puis les sauts deviennent plus faibles
#On peut donc choisir de d?couper en 5 groupes

#dendrogramme avec mat?rialisation des groupes
plot(cah.ward)
rect.hclust(cah.ward,k=5)
#d?coupage en 5 groupes
groupes.cah <- cutree(cah.ward,k=5)

```

#### Analyse des groupes

```{r}
#liste des groupes
print(sort(groupes.cah))

#difficile d'analyser les groupes au 1er abord, on va donc compl?ter l'analyse avec une acp norm?e
#ACP norm?e
acp <- princomp(data,cor=T,scores=T)
var <- get_pca_var(acp) #Creation d'une variable "var" avec tous les resultats concernants les variables


var
coord = var$coord[,1]
contrib = var$contrib[,1]
cos2 = var$cos2[,1]
display = cbind(coord, contrib, cos2)
display
#screeplot - 1 axe retenu
plot(1:8,acp$sdev^2,type="b",xlab="Nb. de facteurs",ylab="Val. Propres")
#biplot
biplot(acp,cex=0.6,col=c("orange","red"))

#positionnement des groupes dans le plan factoriel avec ?tiquettes des points
plot(acp$scores[,1],acp$scores[,2],type="n",xlim=c(-5,5),ylim=c(-5,5))

text(acp$scores[,1],acp$scores[,2],col=c("red","green","blue","black","orange")[groupes.cah],cex
     =0.65,labels=rownames(data),xlim=c(-5,5),ylim=c(-5,5))

#Le graphique suffit ? r?sumer l'information il oppose les pays ayant un fort taux d'in?galit?s de revenu et de faible in?galit?s BE/Esperance et de  faible valeurs  dans : heureux esperance et bien ?tre aux pays qui ont des fortes valeurs dans les variables esp?rance, in?galit?s d'esp?rance, bien ?tre, heureux, in?galit? de bien ?tre et une faible valeur concernant les in?galit?s de revenus

```

### *Comparaison avec les kmeans*

```{r}
#kmeans avec les donn?es centr?es et r?duites
#center = 5nombre de groupes demand?s
#nstart = 5 nombre d'essais avec diff?rents individus de d?part

groupes.kmeans<- kmeans (data.cr,centers=5,nstart=5)
#affichage des r?sultats
print(groupes.kmeans)

#?valuation la proportion d'inertie expliqu?e
inertie.expl <- rep(0,times=10)
for (k in 2:10){
  clus <- kmeans(data.cr,centers=k,nstart=5)
  inertie.expl[k] <- clus$betweenss/clus$totss
}
#graphique
plot(1:10,inertie.expl,type="b",xlab="Nb. de groupes",ylab="% inertie expliqu?e")
#indice de Calinski Harabasz - utilisation du package fpc
#?valuation des solutions
sol.kmeans <- kmeansruns(data.cr,krange=2:10,criterion="ch")
#graphique
plot(1:10,sol.kmeans$crit,type="b",xlab="Nb. de groupes",ylab="Silhouette")

plot(cah.ward)
rect.hclust(cah.ward,k=3)

#groupes
groupes.subset <- cutree(cah.ward,k=3)
#affichage des groupes
print(sort(groupes.subset))
#acp
acp.subset <- princomp(data,cor=T,scores=T)
#screeplot - 1 axe retenu
plot(1:8,acp.subset$sdev^2,type="b")
#biplot
biplot(acp.subset,cex=0.65)
plot(acp.subset$scores[,1],acp.subset$scores[,2],type="n",xlim=c(-5,5),ylim=c(-5,5))

text(acp.subset$scores[,1],acp.subset$scores[,2],col=c("red","green","blue")[groupes.subset],cex
     =0.65,labels=rownames(data),xlim=c(-5,5),ylim=c(-5,5))

```

### *Statistiques sur la construction des groupes*

```{r}
stat.comp <- function(x,y){
  #nombre de groupes
  K <- length(unique(y))
  #nb. d'observations
  n <- length(x)
  #moyenne globale
  m <- mean(x)
  #variabilit? totale
  TSS <- sum((x-m)^2)
  #effectifs conditionnels
  nk <- table(y)
  #moyennes conditionnelles
  mk <- tapply(x,y,mean)
  #variabilit? expliqu?e
  BSS <- sum(nk * (mk - m)^2)
  #moyennes + prop. variance expliqu?e
  result <- c(mk,100.0*BSS/TSS)
  #nommer les ?lements du vecteur
  names(result) <- c(paste("G",1:K),"% epl.")
  #renvoyer le vecteur r?sultat
  return(result)
}
#appliquer stat.comp aux variables de la base originelle fromage
#et non pas aux variables centr?es et r?duites
print(sapply(data,stat.comp,y=groupes.cah))
print(sapply(data,stat.comp,y=groupes.subset))

```

